<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<title>BIOSKOP SHARE v6.2</title>
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<style>
body {
    background:#0b0b0b;
    color:#00ff9c;
    font-family:Arial, sans-serif;
    text-align:center;
    padding:20px;
}

.card {
    max-width:900px;
    margin:auto;
    padding:25px;
    border:2px solid #00ff9c;
    border-radius:14px;
    background:#111;
    box-shadow:0 0 25px #00ff9c;
}

input {
    padding:10px;
    margin:5px;
    background:black;
    border:1px solid #00ff9c;
    color:#00ff9c;
}

button {
    padding:10px 18px;
    margin:5px;
    cursor:pointer;
    font-weight:bold;
}

.host { background:#00ff9c; border:none; color:black; }
.join { background:black; border:1px solid #00ff9c; color:#00ff9c; }

video {
    width:100%;
    margin-top:20px;
    background:black;
    border-radius:6px;
    border:1px solid #333;
}

#log {
    height:150px;
    overflow:auto;
    background:black;
    border:1px solid #333;
    margin-top:15px;
    padding:10px;
    text-align:left;
    font-size:13px;
}
</style>
</head>

<body>
<div class="card">
<h2>游꿟 BIOSKOP SHARE v6.2</h2>

<div>
<input id="hostId" placeholder="Ime kanala (host)">
<button class="host" onclick="startHost()">Pokreni stream</button>
</div>

<div>
<input id="joinId" placeholder="Ime hosta">
<button class="join" onclick="joinHost()">Pove쬴 se</button>
</div>

<div id="log"></div>
<video id="video" autoplay playsinline controls></video>
</div>

<script>
const video = document.getElementById("video");
const logBox = document.getElementById("log");

let peer;
let call;
let stream;

function log(msg){
    logBox.innerHTML += "> " + msg + "<br>";
    logBox.scrollTop = logBox.scrollHeight;
}

const config = {
    config:{
        iceServers:[
            {urls:"stun:stun.l.google.com:19302"},
            {urls:"stun:stun1.l.google.com:19302"},
            {
                urls:"turn:openrelay.metered.ca:80",
                username:"openrelayproject",
                credential:"openrelayproject"
            },
            {
                urls:"turn:openrelay.metered.ca:443",
                username:"openrelayproject",
                credential:"openrelayproject"
            }
        ]
    },
    debug:1
};

// ---------------- HOST -----------------
async function startHost(){
    const id = document.getElementById("hostId").value;
    if(!id){ alert("Upi코i ime kanala"); return; }

    log("Pokre캖em screen share...");
    try{
        stream = await navigator.mediaDevices.getDisplayMedia({
            video:{ width:1920, height:1080, frameRate:60 },
            audio:true
        });
        video.srcObject = stream;
        log("Screen share aktivan");

    }catch(e){
        log("Dozvoli screen share!");
        return;
    }

    log("Pokre캖em server...");
    peer = new Peer(id, config);

    peer.on("open", ()=>log("Kanal otvoren: " + id));

    peer.on("call", incomingCall => {
        log("Gledalac se povezao");
        call = incomingCall;
        call.answer(stream);
        optimizeBitrate(call);
        call.on("close", ()=>log("Gledalac je prekinuo vezu"));
    });

    peer.on("error", e => log("Gre코ka: " + e.type));
}

// Pove캖ava bitrate i frame rate na 1080p 60fps
function optimizeBitrate(call){
    setTimeout(()=>{
        const pc = call.peerConnection;
        pc.getSenders().forEach(sender=>{
            if(sender.track && sender.track.kind === "video"){
                let params = sender.getParameters();
                if(!params.encodings) params.encodings=[{}];
                params.encodings[0].maxBitrate = 10000000; // 10 Mbps
                params.encodings[0].maxFramerate = 60;
                sender.setParameters(params);
            }
        });
    },2000);
}

// ---------------- GLEDALEC -----------------
function joinHost(){
    const id = document.getElementById("joinId").value;
    if(!id){ alert("Upi코i host ID"); return; }

    log("Povezujem se...");
    peer = new Peer(undefined, config);

    peer.on("open", ()=>{
        call = peer.call(id, null); // ne 코alje svoj stream
        call.on("stream", remoteStream=>{
            video.srcObject = remoteStream;
            log("Stream primljen!");
        });
        call.on("error", e=>log("Ne mo쬰 da se pove쬰: " + e.type));
    });

    peer.on("error", e=>log("Gre코ka: " + e.type));
}
</script>
</body>
</html>
