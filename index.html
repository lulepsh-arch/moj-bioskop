<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <title>CINEMA ULTIMATE - Auto Connect</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #0f0f10; color: #e1e1e1; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: #1a1b1e; padding: 25px; border-radius: 15px; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .box { background: #25262b; padding: 20px; border-radius: 10px; margin: 15px 0; border: 1px solid #3d3e42; }
        input { padding: 12px; width: 60%; border-radius: 5px; border: 1px solid #444; background: #121212; color: #fff; margin-bottom: 10px; }
        button { padding: 12px 25px; cursor: pointer; font-weight: bold; border: none; border-radius: 5px; transition: 0.3s; }
        .btn-h { background: #3ba55c; color: white; }
        .btn-g { background: #5865f2; color: white; }
        button:hover { opacity: 0.8; transform: scale(1.02); }
        #log { font-family: 'Consolas', monospace; font-size: 13px; color: #00ff00; text-align: left; padding: 15px; background: #000; border-radius: 8px; height: 120px; overflow-y: auto; border: 1px solid #222; }
        video { width: 100%; border-radius: 8px; background: #000; margin-top: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.8); }
        h2 { color: #fff; margin-top: 0; }
    </style>
</head>
<body>

<div class="container">
    <h2>游꿘 Bioskop Kontrolna Tabla</h2>

    <div style="display: flex; gap: 20px; justify-content: center;">
        <div class="box" style="flex: 1;">
            <strong>1. HOST (Ti)</strong><br><br>
            <input type="text" id="myId" placeholder="Ime sobe (npr: lulehbo)">
            <button class="btn-h" onclick="startHost()">POKRENI BIOSKOP</button>
        </div>

        <div class="box" style="flex: 1;">
            <strong>2. GOST (Drugar)</strong><br><br>
            <input type="text" id="targetId" placeholder="Ime sobe drugara">
            <button class="btn-g" onclick="startGuest()">PRIKLJU캛I SE</button>
        </div>
    </div>

    <div class="box">
        <strong>Status Povezivanja:</strong>
        <div id="log">Sistem spreman. 캛ekam komandu...</div>
    </div>

    <video id="v" autoplay playsinline controls></video>
</div>

<script>
    const logBox = document.getElementById('log');
    const log = (msg) => { logBox.innerHTML += "<br>> " + msg; logBox.scrollTop = logBox.scrollHeight; };
    let peer = null;
    let localStream = null;

    const config = {
        config: { 
            'iceServers': [
                { 'urls': 'stun:stun.l.google.com:19302' },
                { 'urls': 'stun:stun1.l.google.com:19302' }
            ] 
        }
    };

    async function startHost() {
        const id = document.getElementById('myId').value;
        if(!id) return alert("Mora코 uneti ime kanala!");
        
        peer = new Peer(id, config);
        log("Pravim sobu: " + id);

        peer.on('open', async () => {
            log("Soba otvorena! Sada izaberi HBO prozor...");
            try {
                localStream = await navigator.mediaDevices.getDisplayMedia({ 
                    video: { frameRate: 60 }, 
                    audio: true 
                });
                document.getElementById('v').srcObject = localStream;
                log("Strim je aktivan! Drugar mo쬰 da se pove쬰.");

                // AUTOMATSKO PRIHVATANJE POZIVA - TVOJ ZAHTEV
                peer.on('call', call => {
                    log("Neko se povezuje... Prihvatam automatski!");
                    call.answer(localStream);
                    
                    call.on('stream', () => {
                        // Ovde ne radimo ni코ta, mi samo 코aljemo
                    });
                });

            } catch(e) { log("Gre코ka: Nisi dozvolio deljenje ekrana."); }
        });

        peer.on('error', e => log("Gre코ka: " + e.type));
    }

    function startGuest() {
        const tid = document.getElementById('targetId').value;
        if(!tid) return alert("Unesi ime hosta!");
        
        log("Tra쬴m hosta: " + tid + "...");
        peer = new Peer(config);
        
        peer.on('open', () => {
            const call = peer.call(tid, null);
            log("Zahtev za povezivanje poslat...");

            call.on('stream', remoteStream => {
                log("POVEZANO! Slika sti쬰...");
                document.getElementById('v').srcObject = remoteStream;
            });
        });

        peer.on('error', e => log("Gre코ka kod gosta: " + e.type));
    }
</script>
</body>
</html>
